
<div class="min-h-screen relative  px-6">
  <!-- <div class="flex justify-center my-6 ">
  <input  type="text"  placeholder="Search by name..."  [(ngModel)]="searchTerm"
    class="w-full max-w-lg p-3 rounded-xl shadow-md placeholder:text-black/70   focus:bg-white/20 focus:outline-none focus:ring-2 focus:ring-rose-400 transition"
  />
</div> -->

  <h1 class="text-3xl font-bold text-center mb-8 text-blue-900">๐ฆ ููุชุฌุงุชู ุงูุญุงููุฉ</h1>

    <!-- ================ -->
     @if (!products() || products().length === 0) {
  <div class="text-center text-gray-500 text-lg">
    ูููุด ููุชุฌุงุช ูุถุงูุฉ ูุณู ๐
  </div>
} @else {

  <div class="overflow-x-auto">

    <!-- Search -->
  <div class="text-center">
      <mat-form-field appearance="fill" class="mb-3 w-1/2 ">
      <mat-label>ุงุจุญุซ ุจุฃู ุดุฆ ูู ุจูุงูุงุช ุงูููุชุฌ...</mat-label>
      <input matInput  (keyup)="applyFilter($event)"/>
    </mat-form-field>
  </div>

    <!-- Table -->
    <table mat-table [dataSource]="dataSource" matSort
      class="min-w-full bg-white border border-rose-200 rounded-2xl shadow-md"
    >

      <!-- Name Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="py-3 px-4 text-left bg-rose-100 text-[#4A70A9]">
          Name
        </th>

        <td mat-cell *matCellDef="let product" class="py-3 px-4 font-medium text-rose-700">
          <div class="relative group w-fit">
            <span class="line-clamp-1 max-w-40 block">
              {{ product.name.length > 15 ? (product.name.slice(0, 15) + '...') : product.name }}
            </span>
            <div
              class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs
                     px-5 py-1 rounded opacity-0 group-hover:opacity-100 transition
                     pointer-events-none whitespace-nowrap shadow"
            >
              {{ product.name }}
            </div>
          </div>
        </td>
      </ng-container>

      <!-- Quantity -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="py-3 px-4 text-left bg-rose-100 text-[#4A70A9]">
          Quantity
        </th>
        <td mat-cell *matCellDef="let product" class="py-3 px-4">
          <span
            class="text-sm px-2 py-1 rounded-full"
            [class.bg-green-100]="product.quantity > (product.lowStockThreshold || 2)"
            [class.text-green-700]="product.quantity > (product.lowStockThreshold || 2)"
            [class.bg-yellow-100]="product.quantity <= (product.lowStockThreshold || 2)"
            [class.text-yellow-700]="product.quantity <= (product.lowStockThreshold || 2)"
          >
            {{ product.quantity }} ูุทุนุฉ
          </span>
        </td>
      </ng-container>

      <!-- Category -->
      <ng-container matColumnDef="category">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="py-3 px-4 text-left bg-rose-100 text-[#4A70A9]">
          Category
        </th>
        <td mat-cell *matCellDef="let product" class="py-3 px-4 text-gray-600">
          {{ product.category }}
        </td>
      </ng-container>

      <!-- Expiry -->
      <ng-container matColumnDef="expiryDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="py-3 px-4 text-left bg-rose-100 text-[#4A70A9]">
          ExpiryDate
        </th>
        <td mat-cell *matCellDef="let product" class="py-3 px-4">
          <span [class]="getExpiryColor(product.expiryDate || '')">
            {{ product.expiryDate }}
          </span>
        </td>
      </ng-container>

      <!-- Price -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="py-3 px-4 text-left bg-rose-100 text-[#4A70A9]">
          Price
        </th>
        <td mat-cell *matCellDef="let product"
            class="py-3 px-4 text-[#4A70A9] font-semibold">
          {{ product.price || 0 }} ุฌููู
        </td>
      </ng-container>

      <!-- Cost -->
      <ng-container matColumnDef="Cost">
        <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="py-3 px-4 text-left bg-rose-100 text-[#4A70A9]">
          Cost
        </th>
        <td mat-cell *matCellDef="let product"
            class="py-3 px-4 text-[#4A70A9] font-semibold">
          {{ product.Cost }} ุฌููู
        </td>
      </ng-container>

      <!-- Settings -->
      <ng-container matColumnDef="settings">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-center  text-[#4A70A9]">
          Setting
        </th>

        <td mat-cell *matCellDef="let product"
            class="py-3 px-4 text-[#4A70A9] font-semibold">

          <button
            (click)="addToCart(product)"
            class=" text-white px-3 py-2 rounded-xl hover:bg-gray-300 transition"
          >๐</button>

          <button
            (click)="startEdit(product)"
            class=" text-white px-3 py-2 rounded-xl hover:bg-gray-300 transition"
          >๐๏ธ</button>

          <button
            (click)="deleteProduct(product.id)"
            class=" text-white px-3 py-2 rounded-xl hover:bg-gray-300 transition"
          >๐ฎ</button>

        </td>
      </ng-container>

      <!-- Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>

    <!-- Paginator -->
    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

  </div>
}


    <!-- ================ -->


  @if (editingProductId()) {
  <div class="bg-white absolute top-5 left-5 right-5 w-[90%] mx-auto  shadow-xl rounded-2xl  p-8 animate-[fadeInUp_1.5s_ease-out]">
  <h2 class="text-3xl font-bold text-center text-[#4A70A9] mb-6 animate-[fadeIn_2s_ease-out]">
  โจ  ุชุนุฏูู ููุชุฌ
  </h2>

  <!-- ููุฑู ุฅุถุงูุฉ ููุชุฌ -->
  <form [formGroup]="editForm" (ngSubmit)="saveEdit()" class="space-y-5 animate-[fadeIn_2s_ease-out]" >
    <!-- ุงูุงุณู&  ุงููุงุฑูุฉ -->
  <div class="flex justify-between items-center gap-6">
      <!-- ุงูุงุณู -->
    <div class=" w-full">
      <label class=" text-gray-700 font-medium mb-2">ุงุณู ุงูููุชุฌ</label>
      <input type="text" formControlName="name" placeholder="ูุซูุงู: ูุฑูู ุชุฑุทูุจ" class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300" />
    </div>

    <!-- ุงููุงุฑูุฉ -->
    <div class=" w-full">
      <label class=" text-gray-700 font-medium mb-2">ุงููุงุฑูุฉ</label>
      <input type="text" formControlName="brand" placeholder="ูุซูุงู: CeraVe ุฃู The Ordinary" class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300"/>
    </div>
  </div>

  <!-- ุณุนุฑ ุงูุดุฑุงุก  &  ุณุนุฑ ุงูุจูุน  -->
  <div class="flex justify-between items-center gap-6">
    <!--  ุณุนุฑ ุงูุดุฑุงุก  -->
    <div class=" w-full">
      <label class=" text-gray-700 font-medium mb-2">ุณุนุฑ ุงูุดุฑุงุก </label>
      <input type="number" formControlName="Cost" placeholder="ุฌููู ูุตุฑู" class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300"/>
    </div>
    <!-- ุณุนุฑ ุงูุจูุน  -->
    <div class=" w-full">
      <label class=" text-gray-700 font-medium mb-2">ุณุนุฑ ุงูุจูุน </label>
      <input type="number" formControlName="price" placeholder="ุฌููู ูุตุฑู" class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300"/>
    </div>
  </div>
 <!-- ุงููููุฉ   &  ุงููุฆุฉ-->
  <div class="flex justify-between items-center gap-6">
       <!-- ุงููููุฉ -->
    <div class=" w-full">
      <label class=" text-gray-700 font-medium mb-2">ุงููููุฉ ุงููุชุงุญุฉ</label>
      <input type="number" formControlName="quantity" placeholder="0" class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300"/>
    </div>
        <!-- ุงููุฆุฉ -->
    <div class=" w-full">
      <label class="block text-gray-700 font-medium mb-2">ุงููุฆุฉ</label>
      <select formControlName="category" class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300" >
        <option value="" disabled selected>ุงุฎุชุฑ ุงููุฆุฉ</option>
        @for (cat of categories(); track $index) { <option value="{{cat}}">{{cat}}</option> }
       
      </select>
    </div>
  </div>



 <!-- ุชุงุฑูุฎ ุงูุตูุงุญูุฉ  & ุงูุญุฏ ุงูุฃุฏูู ูููููุฉ -->
<div class="flex justify-between items-center gap-6">
   <!-- ุชุงุฑูุฎ ุงูุตูุงุญูุฉ -->
  <div class=" w-full">
      <label class=" text-gray-700 font-medium mb-2">ุชุงุฑูุฎ ุงูุตูุงุญูุฉ</label>
      <input  type="date" id="expiryDate" formControlName="expiryDate" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-rose-300 outline-none"/>
  </div>
    <!-- ุงูุญุฏ ุงูุฃุฏูู ูููููุฉ -->
    <div class=" w-full">
      <label class=" text-gray-700 font-medium mb-2">ุญุฏ ุงููููุฉ ููุชูุจูู</label>
      <input type="number" formControlName="lowStockThreshold" placeholder="ูุซูุงู: 5" class="border border-gray-300 rounded-xl px-4 py-2 w-full focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300" />
    </div>
</div>

    <!-- ุงููุตู -->
    <div>
      <label class="block text-gray-700 font-medium mb-2">ุงููุตู ุฃู ุงูููุงุญุธุงุช</label>
      <textarea rows="3" formControlName="description" placeholder="ูุซูุงู: ููุงุณุจ ููุจุดุฑุฉ ุงูุญุณุงุณุฉุ ููุณุชุฎุฏู ุตุจุงุญูุง ููุณุงุกู..." class="border border-gray-300 rounded-xl px-4 py-2 w-full resize-none focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300" ></textarea>
    </div>

 

    <div class="flex gap-2 mt-2">
      <button type="submit" (click)="saveEdit()" class="bg-green-500 text-white px-3 py-1 rounded">ุญูุธ</button>
      <button type="button" (click)="cancelEdit()" class="bg-red-500 text-white px-3 py-1 rounded">ุฅูุบุงุก</button>
    </div>
  </form>
</div>
}
</div>





